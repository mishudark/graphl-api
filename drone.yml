kind: pipeline
name: bazel

steps:
- name: test
  image: mishudark/bazel:1.4
  resources:
    limit:
      cpu: 1
  volumes:
  - name: cache
    path: /root/bazel
    #- name: output
    #  path: /workspace
  commands:
    #- apt install rsync -y
    #- rsync -a /workspace/.bazel /root/output/
  - rm $HOME/.bazelrc
  - make bazel-test
  - make bazel-build
  - make bazel-lint && echo "done"

volumes:
- name: cache
  host:
    path: /mnt/stateful_partition/tmp/

    #- name: output
    #  host:
    #    path: /mnt/stateful_partition/output/
